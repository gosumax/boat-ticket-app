---
trigger: always_on
---
Режим работы: A2A Playwright + автофикс.

Правила:
1) Один цикл = один упавший тест (или один сценарий). Не трогай остальные.
2) Сначала запусти тест, получи FAIL. Зафиксируй: имя теста, шаг, ожидание/факт, скрин/trace.
3) Найди первопричину: UI (рендер/состояние) или API/бек (контракт/данные). Не делай догадок без факта.
4) Фикс: минимальный diff, без рефакторинга, без “красоты”. Нельзя менять логику в общих файлах, используемых не только owner, если это ломает роли.
5) После фикса: повторно запусти ТОЛЬКО этот тест. Если PASS — запусти весь пакет Playwright. 
6) Если после фикса появились новые FAIL — откатывай фикс и объясняй почему. 
7) Никаких изменений production зоны без команды «ДЕЛАЙ».

Команды:
- Запуск одного теста: npx playwright test <имя.spec.js> --headed
- При фейле: npx playwright test <имя.spec.js> --trace on --retries=0
- После фикса: повторить запуск одного теста, затем: npx playwright test

Вывод после каждого цикла:
- Что упало (1 тест)
- Причина (1-2 строки)
- Какие файлы изменены (пути)
- Диф/кратко что изменено
- Результат повторного прогона (PASS/FAIL)

Начинай с smoke: login → dispatcher → quick sale → tickets visible → owner money/boats/sellers reflect → logout.
