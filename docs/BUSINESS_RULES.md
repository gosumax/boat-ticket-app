# BUSINESS RULES — Boat Ticket App

## Roles

### Seller (Продавец)
- Продавец может продавать билеты ТОЛЬКО до seller_cutoff_minutes
- Если seller_cutoff_minutes = NULL → ограничений НЕТ
- Продавец НИКОГДА не может продавать после cutoff
- Продавец НЕ может переопределять правила

### Dispatcher (Диспетчер)
- Диспетчер может продавать билеты до dispatcher_cutoff_minutes
- Dispatcher cutoff всегда >= seller cutoff
- Диспетчер может продавать, даже если продавец уже не может

### Admin
- Управляет шаблонами, лодками, настройками

---

## Trips / Slots

### Типы рейсов
- manual slot — создан вручную
- generated slot — создан из шаблона

❗ Тип рейса НЕ влияет на правила закрытия  
❗ Manual и Generated ОБЯЗАНЫ вести себя одинаково

---

## Закрытие рейса

Рейс считается закрытым ТОЛЬКО если:
- текущее серверное время >= cutoff_time

НЕЛЬЗЯ закрывать рейс:
- по типу (generated / manual)
- по отсутствию шаблона
- по догадкам

---

## Продажа билетов

- Продажа = presale
- Продажа всегда привязана к slotUid
- Любая ошибка должна быть ЯВНОЙ (structured error)
