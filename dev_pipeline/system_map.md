# System Map

> Auto-generated by orchestrator stage `runSystemMap`. Do not edit manually.

## Express Endpoints
| Method | Path | Role | Guards |
| --- | --- | --- | --- |
| GET | /api/admin/boats | admin | authenticateToken, requireAdminRole |
| POST | /api/admin/boats | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/boats/:id | admin | authenticateToken, requireAdminRole |
| PUT | /api/admin/boats/:id | admin | authenticateToken, requireAdminRole |
| DELETE | /api/admin/boats/:id | admin | authenticateToken, requireAdminRole |
| PATCH | /api/admin/boats/:id/active | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/boats/:id/slots | admin | authenticateToken, requireAdminRole |
| POST | /api/admin/boats/:id/slots | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/settings/working-zone | admin | authenticateToken, requireAdminRole |
| PUT | /api/admin/settings/working-zone | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/stats | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/users | admin | authenticateToken, requireAdminRole |
| POST | /api/admin/users | admin | authenticateToken, requireAdminRole |
| PATCH | /api/admin/users/:id | admin | authenticateToken, requireAdminRole |
| DELETE | /api/admin/users/:id | admin | authenticateToken, requireAdminRole |
| POST | /api/admin/users/:id/reset-password | admin | authenticateToken, requireAdminRole |
| GET | /api/admin/work-zone | admin | authenticateToken, requireAdminRole |
| POST | /api/auth/login | public | (none) |
| GET | /api/auth/me | authenticated | authenticateToken |
| GET | /api/dispatcher/shift-ledger/summary | authenticated | authenticateToken |
| POST | /api/dispatcher/shift/close | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/dispatcher/shift/deposit | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/dispatcher/shift/diagnose | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/dispatcher/summary | authenticated | authenticateToken |
| GET | /api/owner/boats | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/invariants | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/manual/day | admin|owner | authenticateToken, canOwnerAccess |
| PUT | /api/owner/manual/day | admin|owner | authenticateToken, canOwnerAccess |
| POST | /api/owner/manual/lock | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/collected-today-by-tripday | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-boat-daily | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-boats | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-days | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-periods | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-periods-daily | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-seller-daily | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/compare-sellers | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/pending-by-day | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/pending-by-day/:day | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/money/summary | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/motivation/day | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/motivation/season | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/motivation/weekly | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/sellers | admin|owner | authenticateToken, canOwnerAccess |
| PUT | /api/owner/sellers/:id/zone | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/sellers/list | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/owner/settings/full | admin|owner | authenticateToken, canOwnerAccess |
| PUT | /api/owner/settings/full | admin|owner | authenticateToken, canOwnerAccess |
| GET | /api/selling/boats | dispatcher|seller | authenticateToken, canSell |
| GET | /api/selling/boats/:type/slots | dispatcher|seller | authenticateToken, canSell |
| GET | /api/selling/dispatcher/boats | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/dispatcher/sellers | dispatcher|seller | authenticateToken, canSell |
| PUT | /api/selling/dispatcher/sellers/:id/zone | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/dispatcher/slots | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/selling/dispatcher/slots | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/dispatcher/slots/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| DELETE | /api/selling/dispatcher/slots/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/dispatcher/slots/:id/active | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/dispatcher/slots/:slotId/tickets | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/presales | dispatcher|seller | authenticateToken, canSell |
| POST | /api/selling/presales | dispatcher|seller | authenticateToken, canSell |
| GET | /api/selling/presales/:id | dispatcher|seller | authenticateToken, canSell |
| PATCH | /api/selling/presales/:id/accept-payment | dispatcher|seller | authenticateToken, canSell |
| PATCH | /api/selling/presales/:id/cancel | dispatcher|seller | authenticateToken, canSell |
| PATCH | /api/selling/presales/:id/cancel-trip-pending | dispatcher|seller | authenticateToken, canSellOrDispatch |
| PATCH | /api/selling/presales/:id/delete | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/presales/:id/move | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/presales/:id/payment | dispatcher|seller | authenticateToken, canSell |
| PATCH | /api/selling/presales/:id/refund | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/presales/:id/seats | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/presales/:id/tickets | dispatcher|seller | authenticateToken, canSell |
| POST | /api/selling/presales/:id/transfer | dispatcher|seller | authenticateToken, canSellOrDispatch |
| PATCH | /api/selling/presales/:id/transfer | dispatcher|seller | authenticateToken, canSellOrDispatch |
| PATCH | /api/selling/presales/:id/used | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/presales/cancelled-trip-pending | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/schedule-template-items | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/selling/schedule-template-items | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/schedule-template-items/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/schedule-template-items/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| DELETE | /api/selling/schedule-template-items/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/selling/schedule-template-items/generate | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/slots/:slotId/tickets | dispatcher|seller | authenticateToken, canSell |
| GET | /api/selling/templates | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/selling/templates | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/templates/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/templates/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| DELETE | /api/selling/templates/:id | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/tickets/:ticketId/delete | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/tickets/:ticketId/refund | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| POST | /api/selling/tickets/:ticketId/transfer | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/tickets/:ticketId/transfer | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| PATCH | /api/selling/tickets/:ticketId/used | admin|owner|dispatcher | authenticateToken, canDispatchManageSlots |
| GET | /api/selling/transfer-options | dispatcher|seller | authenticateToken, canSellOrDispatch |
| DELETE | /api/selling/trips-for-deleted-boats | admin | authenticateToken, isAdmin |

## Middleware Guards
- authenticateToken
- canDispatchManageSlots
- canOwnerAccess
- canSell
- canSellOrDispatch
- isAdmin
- requireAdminRole

## DB Tables
- boat_slots
- boat_slots_new
- boats
- generated_slots
- manual_batches
- manual_boat_stats
- manual_days
- manual_seller_stats
- money_ledger
- motivation_day_settings
- owner_audit_log
- owner_day_snapshots
- owner_settings
- owner_settings_versions
- presales
- sales_transactions
- sales_transactions_canonical
- schedule_template_items
- schedule_templates
- seller_day_stats
- seller_motivation_state
- seller_season_applied_days
- seller_season_stats
- settings
- shift_closures
- SQL
- tickets
- trip_audit_log
- trip_templates
- users

## Money-Related Types
- CARD
- CASH
- CASH_DISCREPANCY
- CASHLESS
- DEPOSIT_TO_OWNER_CARD
- DEPOSIT_TO_OWNER_CASH
- EXPECT_PAYMENT
- INVALID_PAYMENT_METHOD
- INVALID_PAYMENT_SPLIT
- INVALID_PREPAYMENT_AMOUNT
- MIXED
- NO_SALES
- PAYMENT
- PREPAYMENT_EXCEEDS_TOTAL
- PRESALE_PAYMENT
- REFUNDED
- SALARY_PAYOUT_CARD
- SALARY_PAYOUT_CASH
- SALE_ACCEPTED
- SALE_ACCEPTED_CARD
- SALE_ACCEPTED_CASH
- SALE_ACCEPTED_MIXED
- SALE_CANCEL_REVERSE
- SALE_PREPAYMENT
- SALE_PREPAYMENT_CARD
- SALE_PREPAYMENT_CASH
- SALE_PREPAYMENT_MIXED
- SALES_CLOSED

## Main React Views and Related API
### src/views/AdminView.jsx
- ANY /api/admin/stats
- CALL apiClient.createUser(...)
- CALL apiClient.deleteUser(...)
- CALL apiClient.get(...)
- CALL apiClient.getSellers(...)
- CALL apiClient.resetPassword(...)
- CALL apiClient.updateUser(...)

### src/views/DispatcherShiftClose.jsx
- ANY /api/dispatcher/shift-ledger/summary?business_day=${encodeURIComponent(day)}
- ANY /api/dispatcher/shift/close
- ANY /api/dispatcher/shift/deposit

### src/views/DispatcherView.jsx
- (none)

### src/views/LoginPage.jsx
- (none)

### src/views/OwnerMoneyView.jsx
- ANY /api/owner/money/collected-today-by-tripday
- ANY /api/owner/money/compare-days?preset=${encodeURIComponent(compareDaysPreset)}
- ANY /api/owner/money/summary?preset=${encodeURIComponent(preset)}

### src/views/OwnerView.jsx
- ANY /api/owner/boats?preset=all
- ANY /api/owner/money/compare-boat-daily?boatId=${boatId}&fromA=${encodeURIComponent(fromA)}&toA=${encodeURIComponent(toA)}&fromB=${encodeURIComponent(fromB)}&toB=${encodeURIComponent(toB)}&mode=${chartMode}
- ANY /api/owner/money/compare-periods-daily?fromA=${encodeURIComponent(fromA)}&toA=${encodeURIComponent(toA)}&fromB=${encodeURIComponent(fromB)}&toB=${encodeURIComponent(toB)}&mode=${chartMode}
- ANY /api/owner/money/compare-periods?fromA=${encodeURIComponent(fromA)}&toA=${encodeURIComponent(toA)}&fromB=${encodeURIComponent(fromB)}&toB=${encodeURIComponent(toB)}
- ANY /api/owner/money/compare-seller-daily?sellerId=${sellerId}&fromA=${encodeURIComponent(fromA)}&toA=${encodeURIComponent(toA)}&fromB=${encodeURIComponent(fromB)}&toB=${encodeURIComponent(toB)}&mode=${chartMode}
- ANY /api/owner/sellers?preset=all

### src/views/SellerEarnings.jsx
- CALL apiClient.getSellerSales(...)

### src/views/SellerHome.jsx
- (none)

### src/views/SellerMedia.jsx
- (none)

### src/views/SellerView.jsx
- CALL apiClient.get(...)
- GET /api/selling/boats/${encodeURIComponent(type)}/slots
- POST /api/selling/presales

### src/views/UnauthorizedPage.jsx
- (none)
